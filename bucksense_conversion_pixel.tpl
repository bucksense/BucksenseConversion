___INFO___

{
  "displayName": "Bucksense conversion pixel",
  "description": "This is the Bucksense conversion pixel to track conversions",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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Z2VSZWFkeXHJZTwAAAMjaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEQ0RDREM5MjUyM0IxMUU4OUQwMTg1Q0Y2M0I5ODc5OCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEQ0RDREM5MzUyM0IxMUU4OUQwMTg1Q0Y2M0I5ODc5OCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjhFNjA5MUI1NTFEODExRTg5RDAxODVDRjYzQjk4Nzk4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjhFNjA5MUI2NTFEODExRTg5RDAxODVDRjYzQjk4Nzk4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+F/E9AgAACVdJREFUeNrsXWlwFEUU7s0awkJMCEgQAgQCBghXIodIOALBIIKAlFgIFhhRUVBQKC7hhwWCCMVhIQhlRG7FAhQlgkIk3Mit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",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "displayName": "Company ID",
    "simpleValueType": true,
    "name": "company_ID",
    "type": "TEXT",
    "canBeEmptyString": true
  },
  {
    "displayName": "Offer ID",
    "simpleValueType": true,
    "name": "offer_ID",
    "type": "TEXT",
    "canBeEmptyString": true
  },
  {
    "macrosInSelect": true,
    "selectItems": [
      {
        "displayValue": "This is a conversion",
        "value": 0
      },
      {
        "displayValue": "Event 1",
        "value": 1
      },
      {
        "displayValue": "Event 2",
        "value": ""
      },
      {
        "displayValue": "Event 3",
        "value": 3
      },
      {
        "displayValue": "Event 4",
        "value": 4
      },
      {
        "displayValue": "Event 5",
        "value": 5
      },
      {
        "displayValue": "Event 6",
        "value": 6
      }
    ],
    "displayName": "This is the kind of event you are tracking. Conversion or a funnel event (1 to 6)",
    "simpleValueType": true,
    "name": "kindofconversion",
    "type": "SELECT"
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tracking.bucksense.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const logToConsole = require('logToConsole');
const encodeUriComponent = require('encodeUriComponent');
const getUrl = require('getUrl');
const queryPermission = require('queryPermission');
const sendPixel = require('sendPixel');


// Get the URL the user input into the text field
const company_id = data.company_ID;
const offer_id = data.offer_ID;
const kindofconversion = data.kindofconversion;

var url = 'https://tracking.bucksense.com/ts_p?offer_id=<offer>&event_id=<event>&company_id=<company>&qs=&url=<query>';

var referrer = encodeUriComponent(getUrl());

var newurl = url.replace("<company>", company_id);
newurl = newurl.replace("<offer>", offer_id);
newurl = newurl.replace("<query>", referrer);
newurl = newurl.replace("<event>", kindofconversion);


// If the user chose to log debug output, initialize the logging method
const log = logToConsole;


log('Bucksense: Conversion Company ' + company_id);
log('Bucksense: Conversion Offer ' + offer_id);
log('Bucksense: Conversion event ' + kindofconversion);

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  log('Bucksense: Script loaded successfully.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Bucksense: Script load failed.');
  data.gtmOnFailure();
};

// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.


if (queryPermission('send_pixel', newurl)) {
  sendPixel(newurl, onSuccess, onFailure);
} else {
  log('Bucksense: Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___NOTES___

Created on 8/14/2019, 4:54:37 PM
